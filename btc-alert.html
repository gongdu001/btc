<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC ê°€ê²© ê¸‰ë³€ë™ ì•Œë¦¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .price-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .current-price {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .price-change {
            font-size: 18px;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .price-up {
            background: #4CAF50;
        }
        
        .price-down {
            background: #f44336;
        }
        
        .settings {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .alert-log {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .alert-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }
        
        .alert-item:last-child {
            border-bottom: none;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.2);
            color: #ffcdd2;
        }
        
        .server-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .server-info code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
  <div class="container">
    <h1>ğŸª™ BTC/USDT ê°€ê²© ì•Œë¦¼</h1>

    <div class="price-display">
      <div class="current-price" id="currentPrice">-</div>
      <div class="price-change" id="priceChange">ì—°ê²° ëŒ€ê¸°ì¤‘...</div>
    </div>

    <div class="settings">
      <div class="input-group">
        <label for="threshold">ê¸‰ë³€ë™ ê¸°ì¤€ (%)</label>
        <input type="number" id="threshold" value="1" min="0.1" max="10" step="0.1" />
      </div>
      <div class="input-group">
        <label for="timeframe">ë³€í™”ìœ¨ ì¸¡ì • ì‹œê°„ (ì´ˆ)</label>
        <input type="number" id="timeframe" value="60" min="10" max="300" step="10" />
      </div>
      <div class="input-group">
        <label for="interval">ì²´í¬ ê°„ê²© (ì´ˆ)</label>
        <input type="number" id="interval" value="5" min="1" max="60" step="1" />
      </div>
    </div>

    <button id="toggleBtn" onclick="toggleMonitoring()">ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
    <button id="notificationBtn" onclick="requestNotificationPermission()" style="margin-top: 10px;">ì•Œë¦¼ ê¶Œí•œ ìš”ì²­</button>

    <div class="status" id="status">ì¤€ë¹„ ì™„ë£Œ</div>

    <div class="alert-log" id="alertLog">
      <div style="text-align: center; color: rgba(255,255,255,0.5);">ì•Œë¦¼ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
  </div>

  <script>
    let isMonitoring = false;
    let intervalId = null;
    let priceHistory = [];

    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            updateStatus('ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
            document.getElementById('notificationBtn').style.display = 'none';
            new Notification('BTC ê°€ê²© ì•Œë¦¼', {
              body: 'ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!',
              icon: 'https://cdn-icons-png.flaticon.com/512/1490/1490849.png'
            });
          } else {
            updateStatus('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤');
          }
        });
      } else {
        updateStatus('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
      }
    }

    function calculatePriceChange(currentPrice) {
      const timeframe = parseInt(document.getElementById('timeframe').value);
      const interval = parseInt(document.getElementById('interval').value);
      const requiredDataPoints = Math.floor(timeframe / interval);
      if (priceHistory.length < requiredDataPoints) return null;
      const oldPrice = priceHistory[priceHistory.length - requiredDataPoints];
      return ((currentPrice - oldPrice) / oldPrice) * 100;
    }

    function sendNotification(price, changePercent) {
      const timeframe = parseInt(document.getElementById('timeframe').value);
      const timeText = timeframe >= 60 ? `${Math.floor(timeframe / 60)}ë¶„` : `${timeframe}ì´ˆ`;
      const direction = changePercent > 0 ? 'ìƒìŠ¹' : 'í•˜ë½';
      const message = `BTC ê°€ê²©ì´ ${timeText}ê°„ ${Math.abs(changePercent).toFixed(2)}% ${direction}í–ˆìŠµë‹ˆë‹¤!\ní˜„ì¬ê°€: $${price.toFixed(2)}`;
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('âš ï¸ BTC ê°€ê²© ê¸‰ë³€ë™!', {
          body: message,
          icon: 'https://cdn-icons-png.flaticon.com/512/1490/1490849.png',
          requireInteraction: true
        });
      }
      addAlertLog(message);
      playAlertSound();
    }

    function addAlertLog(message) {
      const logDiv = document.getElementById('alertLog');
      const alertItem = document.createElement('div');
      alertItem.className = 'alert-item';
      const time = new Date().toLocaleTimeString('ko-KR');
      alertItem.textContent = `[${time}] ${message}`;
      if (logDiv.children.length === 1 && logDiv.firstChild.textContent.includes('ì•Œë¦¼ ë‚´ì—­ì´')) {
        logDiv.innerHTML = '';
      }
      logDiv.insertBefore(alertItem, logDiv.firstChild);
      while (logDiv.children.length > 10) {
        logDiv.removeChild(logDiv.lastChild);
      }
    }

    function playAlertSound() {
      const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE');
      audio.play().catch(e => console.log('ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', e));
    }

    function toggleMonitoring() {
      const btn = document.getElementById('toggleBtn');
      if (isMonitoring) {
        stopMonitoring();
        btn.textContent = 'ëª¨ë‹ˆí„°ë§ ì‹œì‘';
        btn.style.background = '#4CAF50';
        updateStatus('ëª¨ë‹ˆí„°ë§ ì¤‘ì§€ë¨');
      } else {
        startMonitoring();
        btn.textContent = 'ëª¨ë‹ˆí„°ë§ ì¤‘ì§€';
        btn.style.background = '#f44336';
        updateStatus('ëª¨ë‹ˆí„°ë§ ì‹œì‘ë¨');
      }
    }

    function startMonitoring() {
      isMonitoring = true;
      priceHistory = [];
      const intervalSeconds = parseInt(document.getElementById('interval').value);
      checkPrice();
      intervalId = setInterval(checkPrice, intervalSeconds * 1000);
    }

    function stopMonitoring() {
      isMonitoring = false;
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }
    }

    async function checkPrice() {
      try {
        const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
        const data = await response.json();
        const price = parseFloat(data.price);
        document.getElementById('currentPrice').textContent = `$${price.toFixed(2)}`;
        priceHistory.push(price);

        const timeframe = parseInt(document.getElementById('timeframe').value);
        const interval = parseInt(document.getElementById('interval').value);
        const maxHistory = Math.ceil(timeframe / interval) + 1;
        if (priceHistory.length > maxHistory) priceHistory.shift();

        const changePercent = calculatePriceChange(price);
        const changeDiv = document.getElementById('priceChange');

        if (changePercent !== null) {
          const threshold = parseFloat(document.getElementById('threshold').value);
          const timeText = timeframe >= 60 ? `${Math.floor(timeframe / 60)}ë¶„` : `${timeframe}ì´ˆ`;
          changeDiv.textContent = `${timeText} ë³€í™”ìœ¨: ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
          changeDiv.className = `price-change ${changePercent >= 0 ? 'price-up' : 'price-down'}`;
          if (Math.abs(changePercent) >= threshold) {
            sendNotification(price, changePercent);
          }
        } else {
          const requiredDataPoints = Math.floor(timeframe / interval);
          const currentDataPoints = priceHistory.length;
          const remainingTime = (requiredDataPoints - currentDataPoints) * interval;
          changeDiv.textContent = `ë°ì´í„° ìˆ˜ì§‘ ì¤‘... (${remainingTime}ì´ˆ ë‚¨ìŒ)`;
          changeDiv.className = 'price-change';
        }

        updateStatus(`ë§ˆì§€ë§‰ ì²´í¬: ${new Date().toLocaleTimeString('ko-KR')}`);
      } catch (error) {
        console.error('ê°€ê²© ì¡°íšŒ ì‹¤íŒ¨:', error);
        document.getElementById('status').className = 'status error';
        updateStatus(`ì˜¤ë¥˜: ${error.message}`);
        document.getElementById('priceChange').textContent = 'Binance ì—°ê²° ì‹¤íŒ¨';
        document.getElementById('priceChange').className = 'price-change price-down';
      }
    }

    function updateStatus(message) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      if (!message.includes('ì˜¤ë¥˜')) statusDiv.className = 'status';
    }

    // ì´ˆê¸° ì•Œë¦¼ ê¶Œí•œ ì²´í¬
    if ('Notification' in window && Notification.permission === 'granted') {
      document.getElementById('notificationBtn').style.display = 'none';
    }

    // ì´ˆê¸° ê°€ê²© í™•ì¸
    checkPrice();
  </script>
</body>
</html>